/**
 * HTMLGenerator
 * テスト用のHTMLテンプレートを生成するクラス
 */
export class HTMLGenerator {
  /**
   * Three.js用のHTMLテンプレートを生成する
   * @param {Function} userScript - ページに注入するユーザースクリプト
   * @param {Object} options - テンプレート生成オプション
   * @param {string} options.title - ページタイトル (デフォルト: 'Three.js Test Environment')
   * @param {string} options.threeJsVersion - Three.jsのバージョン (デフォルト: 'r128')
   * @param {boolean} options.autoExecute - スクリプトの自動実行 (デフォルト: true)
   * @returns {string} 生成されたHTMLコンテンツ
   * @throws {Error} ユーザースクリプトが無効な場合
   */
  generateTestHTML(userScript, options = {}) {
    if (typeof userScript !== 'function') {\n      throw new Error('userScript must be a function');\n    }\n\n    const config = {\n      title: 'Three.js Test Environment',\n      threeJsVersion: 'r128',\n      autoExecute: true,\n      ...options\n    };\n\n    const userScriptString = userScript.toString();\n    const threeJsUrl = this._getThreeJsUrl(config.threeJsVersion);\n\n    const scriptExecution = config.autoExecute\n      ? `\n        window.addEventListener('load', function() {\n            try {\n                if (typeof THREE === 'undefined') {\n                    console.error('Three.js failed to load');\n                    window.threeJsLoadError = true;\n                    return;\n                }\n                (${userScriptString})();\n            } catch (error) {\n                console.error('Error executing user script:', error);\n                window.userScriptError = error;\n            }\n        });`\n      : `\n        window.userScript = ${userScriptString};`;\n\n    return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${config.title}</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            overflow: hidden;\n            background-color: #000;\n            font-family: Arial, sans-serif;\n        }\n        #three-canvas {\n            display: block;\n            width: 100vw;\n            height: 100vh;\n        }\n        .debug-info {\n            position: absolute;\n            top: 10px;\n            left: 10px;\n            color: white;\n            background: rgba(0, 0, 0, 0.7);\n            padding: 10px;\n            border-radius: 5px;\n            font-size: 12px;\n            z-index: 1000;\n            display: none;\n        }\n    </style>\n</head>\n<body>\n    <canvas id=\"three-canvas\"></canvas>\n    <div class=\"debug-info\" id=\"debug-info\">\n        Debug info will appear here\n    </div>\n    \n    <script>\n        window.threeJsLoadError = false;\n        \n        (function() {\n            var script = document.createElement('script');\n            script.src = '${threeJsUrl}';\n            script.onload = function() {\n                console.log('Three.js loaded successfully');\n                window.threeJsLoaded = true;\n            };\n            script.onerror = function() {\n                console.error('Failed to load Three.js from:', script.src);\n                window.threeJsLoadError = true;\n            };\n            document.head.appendChild(script);\n        })();\n    </script>\n    \n    <script>${scriptExecution}\n    </script>\n</body>\n</html>`;\n  }\n\n  /**\n   * Three.jsのバージョンに応じた適切なCDN URLを生成する\n   * @param {string} version - Three.jsのバージョン\n   * @returns {string} CDN URL\n   * @private\n   */\n  _getThreeJsUrl(version) {\n    const normalizedVersion = version.toLowerCase().replace(/^r/, '');\n    \n    const versionMap = {\n      '128': '0.128.0',\n      '140': '0.140.2',\n      '141': '0.141.0',\n      '142': '0.142.0',\n      '143': '0.143.0',\n      '144': '0.144.0',\n      '145': '0.145.0',\n      '146': '0.146.0',\n      '147': '0.147.0',\n      '148': '0.148.0',\n      '149': '0.149.0',\n      '150': '0.150.1',\n      '151': '0.151.3',\n      '152': '0.152.2',\n      '153': '0.153.0',\n      '154': '0.154.0',\n      '155': '0.155.0',\n      '156': '0.156.1',\n      '157': '0.157.0',\n      '158': '0.158.0',\n      '159': '0.159.0',\n      '160': '0.160.1',\n      '161': '0.161.0',\n      '162': '0.162.0',\n      '163': '0.163.0'\n    };\n\n    const mappedVersion = versionMap[normalizedVersion];\n    \n    if (mappedVersion) {\n      return `https://unpkg.com/three@${mappedVersion}/build/three.min.js`;\n    } else {\n      console.warn(`Unknown Three.js version: ${version}, falling back to r128`);\n      return `https://unpkg.com/three@0.128.0/build/three.min.js`;\n    }\n  }\n}"